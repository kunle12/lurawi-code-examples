<xml xmlns="https://developers.google.com/blockly/xml">
  <variables>
    <variable id="5nN@(/}`Lw*:@oXIEcHa">conv_history</variable>
    <variable id="CkF[Wfz+oNahS;D/BJRM">streaming</variable>
    <variable id="[(wXj4iGH=LLjQ,Cu9v%">user_message</variable>
    <variable id="*{!BFHmbPWT8zE00ku07">llmtext</variable>
    <variable id="#ri9|cdr2Q]cM}gfJ$p1">file_content</variable>
    <variable id="Me{wCU?$Bry79xK1M/)-">prompt</variable>
    <variable id="alh53jM}FnzLF{Acr[qy">image_url</variable>
  </variables>
  <block type="behaviour_behaviour" id="^u)KswFJ5x1X@o)VM+OW" x="150" y="-30">
    <field name="IS_DEFAULT">TRUE</field>
    <field name="NAME">main</field>
    <statement name="ACTIONS">
      <block type="behaviour_action" id="aPn?{g?ouh(tO)M{5;.H">
        <field name="PLAY_NEXT">FALSE</field>
        <statement name="ACTIONLETS">
          <block type="bot_interaction_primitive" id="$;=K9V5C:zJP`r:jWt]n">
            <mutation xmlns="http://www.w3.org/1999/xhtml" pt_status="null"></mutation>
            <statement name="ENGAGEMENT">
              <block type="variables_set" id="fixj})V}awfqKqRz?Hl+">
                <field name="VAR" id="5nN@(/}`Lw*:@oXIEcHa">conv_history</field>
                <value name="VALUE">
                  <block type="lists_create_with" id="N6GA,zRfkORp)V?HmQ~*">
                    <mutation items="0"></mutation>
                  </block>
                </value>
                <next>
                  <block type="play_behaviour_primitive" id="2I/f5@bY$DH#2wtY{8eC">
                    <mutation xmlns="http://www.w3.org/1999/xhtml" existing_behaviours="main,input,call_llm,save_conversations,text_summary,call_vlm"></mutation>
                    <field name="BEHAVIOURS">input</field>
                    <field name="ACTION_INDEX">0</field>
                  </block>
                </next>
              </block>
            </statement>
            <statement name="USERDATA">
              <block type="play_behaviour_primitive" id="#P8k!aCfvAQhO=zx#5h$">
                <mutation xmlns="http://www.w3.org/1999/xhtml" existing_behaviours="main,input,call_llm,save_conversations,text_summary,call_vlm"></mutation>
                <field name="BEHAVIOURS">input</field>
                <field name="ACTION_INDEX">0</field>
              </block>
            </statement>
          </block>
        </statement>
      </block>
    </statement>
  </block>
  <block type="behaviour_behaviour" id="94H`SI`Hv.DI^[__4?wK" x="973" y="-46">
    <field name="IS_DEFAULT">FALSE</field>
    <field name="NAME">call_llm</field>
    <statement name="ACTIONS">
      <block type="behaviour_action" id="nbDBIjN!W|tRN@l*Q7n2">
        <field name="PLAY_NEXT">FALSE</field>
        <statement name="ACTIONLETS">
          <block type="custom_primitive" id="`72%O):/g=:*:}BbXv)N">
            <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="current_datetime"></mutation>
            <field name="SCRIPTS">current_datetime</field>
            <next>
              <block type="custom_primitive" id="bC7@FD1=L7ONmE~b9(k8">
                <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="build_gpt_prompt"></mutation>
                <field name="SCRIPTS">build_gpt_prompt</field>
                <value name="ARG0">
                  <block type="text_join" id="_JWb#ay,V}GI[QF|$%TQ">
                    <mutation items="3"></mutation>
                    <value name="ADD0">
                      <block type="text" id="g8Ev@S:m.S2lrZBQz`j%">
                        <field name="TEXT">You are a helpful assistant. You need to follow the instructions from human as close as possible and provide answer as accurate and succinct as possible. If you don't know the answer, just say I don't know the answer. Your current time is </field>
                      </block>
                    </value>
                    <value name="ADD1">
                      <block type="text" id="]s7X/Hs~)lPlwhrmn{xm">
                        <field name="TEXT">CURRENT_DATETIME</field>
                      </block>
                    </value>
                    <value name="ADD2">
                      <block type="text" id="O_r[-Kw,mNs#!,(^FUal">
                        <field name="TEXT">. You are located in Sydney Australia.</field>
                      </block>
                    </value>
                  </block>
                </value>
                <value name="ARG1">
                  <block type="variables_get" id=";{ffPNXaR/l!X@s[,Soo">
                    <field name="VAR" id="[(wXj4iGH=LLjQ,Cu9v%">user_message</field>
                  </block>
                </value>
                <value name="ARG3">
                  <block type="variables_get" id="*c2nzj]D8][L7]cBVMp+">
                    <field name="VAR" id="5nN@(/}`Lw*:@oXIEcHa">conv_history</field>
                  </block>
                </value>
                <value name="ARG7">
                  <block type="variables_get" id="i4bG{YZGH5LPe`)O{]C[">
                    <field name="VAR" id="Me{wCU?$Bry79xK1M/)-">prompt</field>
                  </block>
                </value>
                <next>
                  <block type="custom_primitive" id="n*udu/fkx(#a5tH[FG@5">
                    <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="invoke_llm"></mutation>
                    <field name="SCRIPTS">invoke_llm</field>
                    <value name="ARG0">
                      <block type="text" id="3xtc1|4[#*u}:N@CS|G{">
                        <field name="TEXT">http://localhost:8081</field>
                      </block>
                    </value>
                    <value name="ARG1">
                      <block type="text" id="}}iE`#%J.H_E/QjFoS-x">
                        <field name="TEXT">teepee</field>
                      </block>
                    </value>
                    <value name="ARG2">
                      <block type="text" id="6tOp8=3r2pu^YG,xAx79">
                        <field name="TEXT">test</field>
                      </block>
                    </value>
                    <value name="ARG3">
                      <block type="variables_get" id="V8(h%99YRE%11)Ps2mn4">
                        <field name="VAR" id="Me{wCU?$Bry79xK1M/)-">prompt</field>
                      </block>
                    </value>
                    <value name="ARG4">
                      <block type="math_number" id="{g[.D}cX6epvA%D._@cX">
                        <field name="NUM">0.6</field>
                      </block>
                    </value>
                    <value name="ARG5">
                      <block type="math_number" id="JpC@|3RNs?x`VetU.B9-">
                        <field name="NUM">8192</field>
                      </block>
                    </value>
                    <value name="ARG6">
                      <block type="variables_get" id="3$dk95T!aB4#e5JRVK[K">
                        <field name="VAR" id="CkF[Wfz+oNahS;D/BJRM">streaming</field>
                      </block>
                    </value>
                    <value name="ARG7">
                      <block type="variables_get" id="*2IqxlGI6aE0!D,W/,!F">
                        <field name="VAR" id="*{!BFHmbPWT8zE00ku07">llmtext</field>
                      </block>
                    </value>
                    <statement name="ARG8">
                      <block type="play_behaviour_primitive" id="t)v?C?.jl}CIePkDB6x3">
                        <mutation xmlns="http://www.w3.org/1999/xhtml" existing_behaviours="main,input,call_llm,save_conversations,text_summary,call_vlm"></mutation>
                        <field name="BEHAVIOURS">save_conversations</field>
                        <field name="ACTION_INDEX">0</field>
                      </block>
                    </statement>
                    <statement name="ARG9">
                      <block type="text_primitive" id="OgEzAk5hR|n~d6`w@`|k">
                        <value name="VALUE">
                          <block type="text" id="h714WMO@HR/2,_E7*-SS">
                            <field name="TEXT">System error</field>
                          </block>
                        </value>
                      </block>
                    </statement>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </statement>
      </block>
    </statement>
  </block>
  <block type="behaviour_behaviour" id="xUSO!jW%=:GP,VrV)iNh" x="150" y="230">
    <field name="IS_DEFAULT">FALSE</field>
    <field name="NAME">input</field>
    <statement name="ACTIONS">
      <block type="behaviour_action" id="5byq35J=A;sF52=~pARh">
        <field name="PLAY_NEXT">TRUE</field>
        <statement name="ACTIONLETS">
          <block type="custom_primitive" id="iN@zJ|B#r(W|7O[iMve#">
            <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="query_knowledgebase"></mutation>
            <field name="SCRIPTS">query_knowledgebase</field>
            <value name="ARG1">
              <block type="text" id="C|mC/6J[V#eF?{Zv:SOb">
                <field name="TEXT">USER_DATA</field>
              </block>
            </value>
            <value name="ARG2">
              <block type="text" id="jv3nl;TkK@7+u4E]0)2V">
                <field name="TEXT">stream</field>
              </block>
            </value>
            <value name="ARG4">
              <block type="variables_get" id="6f@vK6pqy.-5FyOt18D2">
                <field name="VAR" id="CkF[Wfz+oNahS;D/BJRM">streaming</field>
              </block>
            </value>
            <statement name="ARG7">
              <block type="variables_set" id="b*@sRO+PM[gC2q%(~xDe">
                <field name="VAR" id="CkF[Wfz+oNahS;D/BJRM">streaming</field>
                <value name="VALUE">
                  <block type="logic_boolean" id="h2B*vf+)J6-WKt^tCrq}">
                    <field name="BOOL">FALSE</field>
                  </block>
                </value>
              </block>
            </statement>
          </block>
        </statement>
        <next>
          <block type="behaviour_action" id="hy3]f.!+lg8rteVng}SX">
            <field name="PLAY_NEXT">TRUE</field>
            <statement name="ACTIONLETS">
              <block type="custom_primitive" id="~6Wx+wV{v:QUCN{m=Qcd">
                <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="query_knowledgebase"></mutation>
                <field name="SCRIPTS">query_knowledgebase</field>
                <value name="ARG1">
                  <block type="text" id="G~(RoX+#[6n?F2omez2t">
                    <field name="TEXT">USER_DATA</field>
                  </block>
                </value>
                <value name="ARG2">
                  <block type="text" id="nQ!^bTNBIVI^%UXMKnrF">
                    <field name="TEXT">message</field>
                  </block>
                </value>
                <value name="ARG4">
                  <block type="variables_get" id="0-!gp$^T`BzQvR]!$u{7">
                    <field name="VAR" id="[(wXj4iGH=LLjQ,Cu9v%">user_message</field>
                  </block>
                </value>
                <statement name="ARG7">
                  <block type="text_primitive" id="~`ote7-BJ,p.k^#rSCEV">
                    <value name="VALUE">
                      <block type="text" id="O?~1A__Uu{9jWnv.$iH}">
                        <field name="TEXT">System error</field>
                      </block>
                    </value>
                  </block>
                </statement>
              </block>
            </statement>
            <next>
              <block type="behaviour_action" id="baWIv?S?rSL9CeT05+mX">
                <field name="PLAY_NEXT">FALSE</field>
                <statement name="ACTIONLETS">
                  <block type="custom_primitive" id="sbimh33LFiuu4J_Vfgm}">
                    <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="query_knowledgebase"></mutation>
                    <field name="SCRIPTS">query_knowledgebase</field>
                    <value name="ARG1">
                      <block type="text" id="7]znnScy5CJ~#1kechXg">
                        <field name="TEXT">USER_DATA</field>
                      </block>
                    </value>
                    <value name="ARG2">
                      <block type="text" id="NcKP^$W/]1BBW8[2[{?U">
                        <field name="TEXT">image_attachment_url</field>
                      </block>
                    </value>
                    <value name="ARG4">
                      <block type="variables_get" id=";(7:$a5/mdHEY!TF^`/t">
                        <field name="VAR" id="alh53jM}FnzLF{Acr[qy">image_url</field>
                      </block>
                    </value>
                    <statement name="ARG6">
                      <block type="custom_primitive" id="ePtZ@wqRa$[{#/XVJH?x">
                        <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="file_loader"></mutation>
                        <field name="SCRIPTS">file_loader</field>
                        <value name="ARG0">
                          <block type="variables_get" id="Ivoo.NcFoJR={*:G$C:p">
                            <field name="VAR" id="alh53jM}FnzLF{Acr[qy">image_url</field>
                          </block>
                        </value>
                        <value name="ARG1">
                          <block type="text" id="T)N8oXL_({R,tPIJV-Z7">
                            <field name="TEXT">image</field>
                          </block>
                        </value>
                        <value name="ARG2">
                          <block type="variables_get" id="(B?-SJy1BGvgNczzhnu4">
                            <field name="VAR" id="#ri9|cdr2Q]cM}gfJ$p1">file_content</field>
                          </block>
                        </value>
                        <statement name="ARG3">
                          <block type="play_behaviour_primitive" id="3R@QH@s_)80;{e`R2HDk">
                            <mutation xmlns="http://www.w3.org/1999/xhtml" existing_behaviours="main,input,call_llm,save_conversations,text_summary,call_vlm"></mutation>
                            <field name="BEHAVIOURS">call_vlm</field>
                            <field name="ACTION_INDEX">0</field>
                          </block>
                        </statement>
                        <statement name="ARG4">
                          <block type="text_primitive" id="h^zR;yS=7Q2An8,qP3W[">
                            <value name="VALUE">
                              <block type="text" id="ve|5/j_;ME2C^^%n[dK$">
                                <field name="TEXT">can not to load image</field>
                              </block>
                            </value>
                          </block>
                        </statement>
                      </block>
                    </statement>
                    <statement name="ARG7">
                      <block type="play_behaviour_primitive" id="?_M(e-Z+iY58TpESJ=:C">
                        <mutation xmlns="http://www.w3.org/1999/xhtml" existing_behaviours="main,input,call_llm,save_conversations,text_summary,call_vlm"></mutation>
                        <field name="BEHAVIOURS">call_llm</field>
                        <field name="ACTION_INDEX">0</field>
                      </block>
                    </statement>
                  </block>
                </statement>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>
  </block>
  <block type="behaviour_behaviour" id="c~Zdu(T]jetvx(=~Tf]$" x="1610" y="610">
    <field name="IS_DEFAULT">FALSE</field>
    <field name="NAME">save_conversations</field>
    <statement name="ACTIONS">
      <block type="behaviour_action" id="#(..pCv~J`h_[Hd_StH2">
        <field name="PLAY_NEXT">FALSE</field>
        <statement name="ACTIONLETS">
          <block type="custom_primitive" id="`)H~vYp+lM;_whL:@{|/">
            <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="cache_conversation_history"></mutation>
            <field name="SCRIPTS">cache_conversation_history</field>
            <value name="ARG0">
              <block type="variables_get" id="$Bq?qN|U%OJVGVO}*@/)">
                <field name="VAR" id="[(wXj4iGH=LLjQ,Cu9v%">user_message</field>
              </block>
            </value>
            <value name="ARG1">
              <block type="variables_get" id="m}`UA!tK-RK3K`u^@b]n">
                <field name="VAR" id="*{!BFHmbPWT8zE00ku07">llmtext</field>
              </block>
            </value>
            <value name="ARG2">
              <block type="variables_get" id="H2JYb5AE48VcA_VIX9k*">
                <field name="VAR" id="5nN@(/}`Lw*:@oXIEcHa">conv_history</field>
              </block>
            </value>
            <value name="ARG3">
              <block type="math_number" id="Mi16=!YjU))-T_y0Vpc[">
                <field name="NUM">1000</field>
              </block>
            </value>
            <next>
              <block type="text_primitive" id="gLrB/!oZ`rRewHL:oTc3">
                <value name="VALUE">
                  <block type="variables_get" id="Lc?sp:ZSZU!Rzx72p7#x">
                    <field name="VAR" id="*{!BFHmbPWT8zE00ku07">llmtext</field>
                  </block>
                </value>
                <next>
                  <block type="play_behaviour_primitive" id="wBy.^:gg@i!dmapXv^OX">
                    <mutation xmlns="http://www.w3.org/1999/xhtml" existing_behaviours="main,input,call_llm,save_conversations,text_summary,call_vlm"></mutation>
                    <field name="BEHAVIOURS">main</field>
                    <field name="ACTION_INDEX">0</field>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </statement>
      </block>
    </statement>
  </block>
  <block type="behaviour_behaviour" id="g3UXc3?P71pb+KLBR%?t" x="970" y="730">
    <field name="IS_DEFAULT">FALSE</field>
    <field name="NAME">call_vlm</field>
    <statement name="ACTIONS">
      <block type="behaviour_action" id="Vv|jc}PlT,%hl_0hPD2M">
        <field name="PLAY_NEXT">TRUE</field>
        <statement name="ACTIONLETS">
          <block type="custom_primitive" id="Cfw._fH|FpNs.xpu:x,_">
            <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="build_gpt_prompt"></mutation>
            <field name="SCRIPTS">build_gpt_prompt</field>
            <value name="ARG1">
              <block type="variables_get" id="w^$?|1yM-|i@E`K|Vnso">
                <field name="VAR" id="[(wXj4iGH=LLjQ,Cu9v%">user_message</field>
              </block>
            </value>
            <value name="ARG3">
              <block type="variables_get" id="i.epyM5tz]S-~=H[0L~X">
                <field name="VAR" id="5nN@(/}`Lw*:@oXIEcHa">conv_history</field>
              </block>
            </value>
            <value name="ARG4">
              <block type="variables_get" id="w=2Q_h|z8U$-B.][0-~q">
                <field name="VAR" id="#ri9|cdr2Q]cM}gfJ$p1">file_content</field>
              </block>
            </value>
            <value name="ARG7">
              <block type="variables_get" id="pWU^J/J*UVDf7n0x4-S`">
                <field name="VAR" id="Me{wCU?$Bry79xK1M/)-">prompt</field>
              </block>
            </value>
            <next>
              <block type="custom_primitive" id="1Za{)4O4}BlQ%[5wygqU">
                <mutation xmlns="http://www.w3.org/1999/xhtml" check_custom="invoke_llm"></mutation>
                <field name="SCRIPTS">invoke_llm</field>
                <value name="ARG0">
                  <block type="text" id="D6lPYjw~nx3gnjPjI_vi">
                    <field name="TEXT">http://localhost1:8080</field>
                  </block>
                </value>
                <value name="ARG1">
                  <block type="text" id="[Q;K.k1B/gX5io.qf]62">
                    <field name="TEXT">dev</field>
                  </block>
                </value>
                <value name="ARG2">
                  <block type="text" id="MWSw4G:Ey*.X^+4fr*Dy">
                    <field name="TEXT">qwen3</field>
                  </block>
                </value>
                <value name="ARG3">
                  <block type="variables_get" id="!X-Ca-h,]aur9um/+3}6">
                    <field name="VAR" id="Me{wCU?$Bry79xK1M/)-">prompt</field>
                  </block>
                </value>
                <value name="ARG4">
                  <block type="math_number" id="*z1OsQ_@W`(TFyvEzh],">
                    <field name="NUM">0.2</field>
                  </block>
                </value>
                <value name="ARG5">
                  <block type="math_number" id="`IeA*C$[F:G%kni$l.!V">
                    <field name="NUM">4096</field>
                  </block>
                </value>
                <value name="ARG6">
                  <block type="logic_boolean" id="HrN@24D4:%/Cci`)vT{o">
                    <field name="BOOL">FALSE</field>
                  </block>
                </value>
                <value name="ARG7">
                  <block type="variables_get" id="V7wg-E.d#vnZa_U}P|5[">
                    <field name="VAR" id="*{!BFHmbPWT8zE00ku07">llmtext</field>
                  </block>
                </value>
                <statement name="ARG8">
                  <block type="play_behaviour_primitive" id="Vf#7h6ixzT1GYZ/#.^$_">
                    <mutation xmlns="http://www.w3.org/1999/xhtml" existing_behaviours="main,input,call_llm,save_conversations,text_summary,call_vlm"></mutation>
                    <field name="BEHAVIOURS">save_conversations</field>
                    <field name="ACTION_INDEX">0</field>
                  </block>
                </statement>
                <statement name="ARG9">
                  <block type="text_primitive" id="%.q,4Z^Ch!a2~AlfCi4i">
                    <value name="VALUE">
                      <block type="text" id="TR!IYD7_@QKQx_5U_c49">
                        <field name="TEXT">VLM error</field>
                      </block>
                    </value>
                  </block>
                </statement>
              </block>
            </next>
          </block>
        </statement>
      </block>
    </statement>
  </block>
</xml>